<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hbp-collaboratory-app-toolkit.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hbp-collaboratory-app-toolkit.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*global define,angular*/

(function (root, factory) {
  'use strict';
  if (typeof define === 'function' &amp;&amp; define.amd) {
    // AMD. Register as an anonymous module.
    define([], function() {
      return factory(root);
    });
  } else if (typeof exports === 'object') {
      // Node. Does not work with strict CommonJS, but
      // only CommonJS-like environments that support module.exports,
      // like Node.

      module.exports = factory(root);
  } else if (typeof angular === 'object') {
    // Define an Angular JS module
    angular.module('hbpCollaboratoryAppToolkit', [])
    .factory('hbpCollaboratoryAppToolkit', ['$window', function($window) {
      return factory($window);
    }]);
  } else {
    // Browser globals (root is window)
    root.hbpCollaboratoryAppToolkit = factory(root);
  }
}(this, function factory(window) {
  'use strict';
  var eventId = 0;
  var sentMessages = {};

  /**
   * @module hbpCollaboratoryAppToolkit
   */
  function AppToolkit() { }
  AppToolkit.prototype = {
    emit: emit,
    context: context
  };

  window.addEventListener('message', function(event) {
    if(!event.data.origin) {
      return;
    }
    if(!sentMessages[event.data.origin]) {
      return;
    }
    if (event.data.eventName === 'resolved') {
      sentMessages[event.data.origin](null, event.data.data);
    } else if (event.data.eventName === 'error'){
      sentMessages[event.data.origin](event.data.data);
    }
    sentMessages[event.data.origin] = null;
  });

  function emit(name, data, callback) {
    window.parent.postMessage({
      apiVersion: 1,
      eventName: name,
      data: data,
      ticket: ++eventId
    }, '*');
    sentMessages[eventId] = callback;
  }

  var currentContext;

  /**
   * @typedef HbpCollaboratoryContext
   * @type {object}
   * @property {string} mode - the current mode, either 'run' or 'edit'
   * @property {string} ctx - the UUID of the current context
   * @property {string} state - an application defined state string
   */


  /**
   * @callback hbpCollaboratoryContextCallback
   * @param {HbpError} error - an HbpError
   * @param {HbpCollaboratoryContext} context - the context informations
   */


   /**
    * @desc
    * Asynchronously retrieve the current HBP Collaboratory Context, including
    * the mode, the ctx UUID and the application state if any.
    * @function context
    * @param  [{hbpCollaboratoryContextCallback} callback] - receiver of the call
    * @static
    */
  function context(callback) {
    if (currentContext) {
      callback(null, currentContext);
    }
    var kill = setTimeout(function() {
      callback({
        type: 'TimeoutException',
        message: 'No context can be retrieved'
      }, null);
    }, 250);
    emit('context', {}, function(err, context) {
      clearTimeout(kill)
      if (err) {
        callback(err);
      } else {
        currentContext = context;
        callback(null, currentContext);
      }
    });
    return;
  }

  // Return a value to define the module export.
  // This example returns a functions, but the module
  // can return an object as the exported value.
  return new AppToolkit();
}));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-hbpCollaboratoryAppToolkit.html">hbpCollaboratoryAppToolkit</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jan 06 2016 15:37:00 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
